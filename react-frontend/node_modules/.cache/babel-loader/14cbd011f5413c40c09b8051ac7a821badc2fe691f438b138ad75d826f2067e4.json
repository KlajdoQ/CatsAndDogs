{"ast":null,"code":"var _jsxFileName = \"/Users/kqasolli/Desktop/capstone/CatsAndDogs/react-frontend/src/components/content/ChatModal.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useCallback } from \"react\";\nimport createChatChannel from \"../javascript/channels/chat_channel\";\nimport \"./ChatModal.css\";\nimport debounce from 'lodash/debounce';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst ChatModal = _ref => {\n  _s();\n  let {\n    currentUser,\n    author,\n    handleClose,\n    handleChatButtonClick,\n    newMessage,\n    setNewMessage,\n    show\n  } = _ref;\n  const [messages, setMessages] = useState([]);\n  const [inputValue, setInputValue] = useState(\"\");\n  const [chatChannel, setChatChannel] = useState(null);\n  useEffect(() => {\n    if (newMessage) {\n      setMessages(prevMessages => {\n        const messageExists = prevMessages.some(msg => msg.messageId === newMessage.messageId);\n        if (!messageExists) {\n          return [...prevMessages, newMessage];\n        } else {\n          return prevMessages;\n        }\n      });\n    }\n  }, [newMessage]);\n  const handleReceivedMessage = message => {\n    console.log(\"Received message:\", message);\n    if (message.receiver_id === currentUser.id) {\n      setMessages(prevMessages => {\n        const messageExists = prevMessages.some(msg => msg.messageId === message.messageId);\n        if (!messageExists) {\n          const receivedMessage = {\n            ...message,\n            messageId: Date.now() + Math.random()\n          };\n          handleChatButtonClick(author, true, false, receivedMessage);\n          return [...prevMessages, receivedMessage];\n        } else {\n          return prevMessages;\n        }\n      });\n    }\n  };\n  useEffect(() => {\n    if (currentUser !== null && currentUser !== void 0 && currentUser.id && author !== null && author !== void 0 && author.id) {\n      const channel = createChatChannel(handleReceivedMessage, currentUser.id, author.id);\n      setChatChannel(channel);\n      if (newMessage) {\n        channel.sendMessage(newMessage.content, currentUser === null || currentUser === void 0 ? void 0 : currentUser.id, author === null || author === void 0 ? void 0 : author.id);\n      }\n    }\n  }, [currentUser, author]);\n  const handleInputChange = event => {\n    setInputValue(event.target.value);\n  };\n  const handleSendMessage = useCallback(event => {\n    if (inputValue.trim()) {\n      const newSentMessage = {\n        content: inputValue,\n        user_id: currentUser === null || currentUser === void 0 ? void 0 : currentUser.id,\n        messageId: Date.now() + Math.random()\n      };\n      setMessages(prevMessages => [...prevMessages, newSentMessage]);\n      if (!chatChannel) {\n        const channel = createChatChannel(handleReceivedMessage, currentUser.id);\n        setChatChannel(channel);\n        channel.sendMessage(inputValue, currentUser === null || currentUser === void 0 ? void 0 : currentUser.id, author === null || author === void 0 ? void 0 : author.id);\n      } else {\n        chatChannel.sendMessage(inputValue, currentUser === null || currentUser === void 0 ? void 0 : currentUser.id, author === null || author === void 0 ? void 0 : author.id);\n      }\n      setInputValue('');\n      console.log('New message sent:', newSentMessage.content);\n    }\n  }, [inputValue, currentUser, chatChannel, handleReceivedMessage, author]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: show && /*#__PURE__*/_jsxDEV(\"section\", {\n      style: {\n        backgroundColor: \"#eee\"\n      },\n      className: \"section\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chatModal py-5\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"card\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"card-header d-flex justify-content-between align-items-center p-3\",\n                style: {\n                  borderTop: \"4px solid #ffa900\"\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n                  className: \"mb-0\",\n                  children: \"Chat \"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 115,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: handleClose,\n                  children: \"Close\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 116,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 111,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"card-body\",\n                \"data-mdb-perfect-scrollbar\": \"true\",\n                style: {\n                  position: \"relative\",\n                  height: \"300px\"\n                },\n                children: messages.map(message => /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: message.user_id === currentUser.id ? \"currentUserMessage\" : \"authorMessage\",\n                  children: /*#__PURE__*/_jsxDEV(\"p\", {\n                    children: [\" \", message.content]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 133,\n                    columnNumber: 23\n                  }, this)\n                }, message.messageId, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 125,\n                  columnNumber: 21\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 118,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"card-footer text-muted d-flex justify-content-start align-items-center p-3\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"input-group mb-0\",\n                  children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                    type: \"text\",\n                    className: \"form-control\",\n                    placeholder: \"Type message\",\n                    \"aria-label\": \"Recipient's username\",\n                    \"aria-describedby\": \"button-addon2\",\n                    value: inputValue,\n                    onChange: handleInputChange\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 139,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"btn btn-warning\",\n                    type: \"button\",\n                    style: {\n                      paddingTop: \".55rem\"\n                    },\n                    onClick: handleSendMessage,\n                    children: \"Send\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 148,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 138,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 137,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 110,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 109,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 7\n    }, this)\n  }, void 0, false);\n};\n_s(ChatModal, \"Fvw5t4ipAyBCLdtyxdilddZhnKk=\");\n_c = ChatModal;\nexport default ChatModal;\nvar _c;\n$RefreshReg$(_c, \"ChatModal\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","createChatChannel","debounce","ChatModal","currentUser","author","handleClose","handleChatButtonClick","newMessage","setNewMessage","show","messages","setMessages","inputValue","setInputValue","chatChannel","setChatChannel","prevMessages","messageExists","some","msg","messageId","handleReceivedMessage","message","console","log","receiver_id","id","receivedMessage","Date","now","Math","random","channel","sendMessage","content","handleInputChange","event","target","value","handleSendMessage","trim","newSentMessage","user_id","backgroundColor","borderTop","position","height","map","paddingTop"],"sources":["/Users/kqasolli/Desktop/capstone/CatsAndDogs/react-frontend/src/components/content/ChatModal.js"],"sourcesContent":["import React, { useState, useEffect , useCallback} from \"react\";\nimport createChatChannel from \"../javascript/channels/chat_channel\";\nimport \"./ChatModal.css\";\nimport debounce from 'lodash/debounce';\n\n\nconst ChatModal = ({\n  currentUser,\n  author,\n  handleClose,\n  handleChatButtonClick,\n  newMessage,\n  setNewMessage,\n  show\n}) => {\n  \n  const [messages, setMessages] = useState([]);\n  const [inputValue, setInputValue] = useState(\"\");\n  const [chatChannel, setChatChannel] = useState(null);\n\n\n  useEffect(() => {\n    if (newMessage) {\n      setMessages((prevMessages) => {\n        const messageExists = prevMessages.some(\n          (msg) => msg.messageId === newMessage.messageId\n        );\n  \n        if (!messageExists) {\n          return [...prevMessages, newMessage];\n        } else {\n          return prevMessages;\n        }\n      });\n    }\n  }, [newMessage]);\n  \nconst handleReceivedMessage = (message) => {\n  console.log(\"Received message:\", message);\n  if (message.receiver_id === currentUser.id) {\n    setMessages((prevMessages) => {\n      const messageExists = prevMessages.some(\n        (msg) => msg.messageId === message.messageId\n      );\n\n      if (!messageExists) {\n        const receivedMessage = {\n          ...message,\n          messageId: Date.now() + Math.random(),\n        };\n\n        handleChatButtonClick(author, true, false, receivedMessage);\n        return [...prevMessages, receivedMessage];\n      } else {\n        return prevMessages;\n      }\n    });\n  }\n};\n\n  \n\n  useEffect(() => {\n    if (currentUser?.id && author?.id) {\n      const channel = createChatChannel(handleReceivedMessage, currentUser.id, author.id);\n      setChatChannel(channel);\n      if (newMessage) {\n        channel.sendMessage(newMessage.content, currentUser?.id, author?.id);\n      }\n\n    }\n  }, [currentUser, author]);\n\n  const handleInputChange = (event) => {\n    setInputValue(event.target.value);\n  };\n\n  const handleSendMessage = useCallback((event) => {\n    if (inputValue.trim()) {\n      const newSentMessage = {\n        content: inputValue,\n        user_id: currentUser?.id,\n        messageId: Date.now() + Math.random(),\n      };\n      setMessages((prevMessages) => [...prevMessages, newSentMessage]);\n  \n      if (!chatChannel) {\n        const channel = createChatChannel(handleReceivedMessage, currentUser.id);\n        setChatChannel(channel);\n        channel.sendMessage(inputValue, currentUser?.id, author?.id);\n      } else {\n        chatChannel.sendMessage(inputValue, currentUser?.id, author?.id);\n      }\n  \n      setInputValue('');\n      console.log('New message sent:', newSentMessage.content);\n    }\n  }, [inputValue, currentUser, chatChannel, handleReceivedMessage, author]);\n  \n\n\n  return (\n    <>\n    {show && (\n\n      <section style={{ backgroundColor: \"#eee\" }} className=\"section\">\n        <div className=\"chatModal py-5\">\n          <div className=\"\">\n            <div className=\"\">\n              <div className=\"card\">\n                <div\n                  className=\"card-header d-flex justify-content-between align-items-center p-3\"\n                  style={{ borderTop: \"4px solid #ffa900\" }}\n                >\n                  <h5 className=\"mb-0\">Chat </h5>\n                  <button onClick={handleClose}>Close</button>\n                </div>\n                <div\n                  className=\"card-body\"\n                  data-mdb-perfect-scrollbar=\"true\"\n                  style={{ position: \"relative\", height: \"300px\" }}\n                >\n                  {/* <p>Message 1 </p> */}\n                  {messages.map((message) => (\n                    <div\n                      key={message.messageId}\n                      className={\n                        message.user_id === currentUser.id\n                          ? \"currentUserMessage\"\n                          : \"authorMessage\"\n                      }\n                    >\n                      <p> {message.content}</p>\n                    </div>\n                  ))}\n                </div>\n                <div className=\"card-footer text-muted d-flex justify-content-start align-items-center p-3\">\n                  <div className=\"input-group mb-0\">\n                    <input\n                      type=\"text\"\n                      className=\"form-control\"\n                      placeholder=\"Type message\"\n                      aria-label=\"Recipient's username\"\n                      aria-describedby=\"button-addon2\"\n                      value={inputValue}\n                      onChange={handleInputChange}\n                    />\n                    <button\n                      className=\"btn btn-warning\"\n                      type=\"button\"\n                      style={{ paddingTop: \".55rem\" }}\n                      onClick={handleSendMessage}\n                    >\n                      Send\n                    </button>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </section>\n    )}\n    </>\n  );\n};\n\nexport default ChatModal;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}